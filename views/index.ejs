<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงุนูุฏ - ูุฒุงุฑุฉ ุงูุตุญุฉ</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>

  <body>
    <!-- Login Modal -->
    <div class="login-overlay" id="loginOverlay">
      <div class="login-modal">
        <button class="close-btn" onclick="closeLogin()">&times;</button>
        <h2>ุชุณุฌูู ุงูุฏุฎูู</h2>
        <form id="loginForm">
          <div class="form-group">
            <label for="username">ุงุณู ุงููุณุชุฎุฏู</label>
            <input
              type="text"
              id="username"
              name="username"
              placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู"
              required
            />
          </div>
          <div class="form-group">
            <label for="password">ูููุฉ ุงููุฑูุฑ</label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ"
              required
            />
          </div>
          <div class="login-buttons">
            <button type="submit" class="btn btn-login">ุชุณุฌูู ุงูุฏุฎูู</button>
            <button type="button" class="btn btn-cancel" onclick="closeLogin()">
              ุฅูุบุงุก
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add/Edit Appointment Modal -->
    <div class="modal-overlay" id="appointmentModal">
      <div class="appointment-modal">
        <button class="close-btn" onclick="closeEditAppointmentModal()">
          &times;
        </button>
        <h2>ุฅุถุงูุฉ ููุนุฏ ุฌุฏูุฏ</h2>
        <form id="appointmentForm">
          <div class="form-group">
            <label for="patientName">ุงุณู ุงููุฑูุถ</label>
            <input
              type="text"
              id="patientName"
              name="patientName"
              placeholder="ุฃุฏุฎู ุงุณู ุงููุฑูุถ"
              required
            />
          </div>
          <div class="form-group">
            <label for="patientId">ุฑูู ุงููููุฉ</label>
            <input
              type="text"
              id="patientId"
              name="patientId"
              placeholder="ุฃุฏุฎู ุฑูู ุงููููุฉ"
              required
            />
          </div>
          <div class="form-group">
            <label for="patientPhone">ุฑูู ุงูุฌูุงู</label>
            <input
              type="tel"
              id="patientPhone"
              name="patientPhone"
              placeholder="ุฃุฏุฎู ุฑูู ุงูุฌูุงู"
              required
            />
          </div>
          <div class="form-group">
            <label for="patientBirthDate">ุชุงุฑูุฎ ุงููููุงุฏ (ุงุฎุชูุงุฑู)</label>
            <input
              type="date"
              id="patientBirthDate"
              name="patientBirthDate"
            />
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="appointmentDate">ุงูุชุงุฑูุฎ</label>
              <input
                type="date"
                id="appointmentDate"
                name="appointmentDate"
                required
              />
            </div>
            <div class="form-group">
              <label for="appointmentTime">ุงูููุช</label>
              <input
                type="time"
                id="appointmentTime"
                name="appointmentTime"
                required
              />
            </div>
          </div>
          <div class="form-group">
            <label for="department">ุงููุณู</label>
            <select
              id="department"
              style="background-color: #1e3c72"
              name="department"
              required
            >
              <option value="">ุงุฎุชุฑ ุงููุณู</option>
              <% departments.forEach(function(dept) { %>
              <option value="<%= dept %>"><%= dept %></option>
              <% }); %>
            </select>
          </div>
          <div class="form-group hidden" id="historicalControls">
            <label>
              <input type="checkbox" id="isHistorical" /> ุฅุฏุฎุงู ููุนุฏ ูุฏูู (ุฑูู ูุฏูู)
            </label>
            <input type="number" id="serialNumber" name="serialNumber" placeholder="ุฑูู ุงููุดู/ุงูููุนุฏ" min="1" disabled />
          </div>
          <div class="login-buttons">
            <button type="submit" class="btn btn-login">ุญูุธ ุงูููุนุฏ</button>
            <button
              type="button"
              class="btn btn-cancel"
              onclick="closeEditAppointmentModal()"
            >
              ุฅูุบุงุก
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Search Modal -->
    <div class="modal-overlay" id="searchModal">
      <div class="search-modal">
        <button class="close-btn" onclick="closeSearchModal()">&times;</button>
        <h2>ุจุญุซ ุนู ููุนุฏ</h2>
        <form id="searchForm">
          <div class="search-options">
            <div class="search-option active" data-option="name">ุจุงูุงุณู</div>
            <div class="search-option" data-option="id">ุจุงููููุฉ</div>
            <div class="search-option" data-option="phone">ุจุงูุฌูุงู</div>
            <div class="search-option" data-option="date">ุจุงูุชุงุฑูุฎ</div>
          </div>

          <div class="form-group" id="searchByName">
            <label for="searchName">ุงุณู ุงููุฑูุถ</label>
            <input
              type="text"
              id="searchName"
              name="searchName"
              placeholder="ุฃุฏุฎู ุงุณู ุงููุฑูุถ ููุจุญุซ"
            />
          </div>

          <div class="form-group hidden" id="searchById">
            <label for="searchId">ุฑูู ุงููููุฉ</label>
            <input
              type="text"
              id="searchId"
              name="searchId"
              placeholder="ุฃุฏุฎู ุฑูู ุงููููุฉ ููุจุญุซ"
            />
          </div>

          <div class="form-group hidden" id="searchByPhone">
            <label for="searchPhone">ุฑูู ุงูุฌูุงู</label>
            <input
              type="tel"
              id="searchPhone"
              name="searchPhone"
              placeholder="ุฃุฏุฎู ุฑูู ุงูุฌูุงู ููุจุญุซ"
            />
          </div>

          <div class="form-group hidden" id="searchByDate">
            <label for="searchDate">ุงูุชุงุฑูุฎ</label>
            <input type="date" id="searchDate" name="searchDate" />
          </div>

          <div class="login-buttons">
            <button type="submit" class="btn btn-search">ุจุญุซ</button>
            <button
              type="button"
              class="btn btn-cancel"
              onclick="closeSearchModal()"
            >
              ุฅูุบุงุก
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Departments Management Modal -->
    <div class="modal-overlay" id="departmentsModal">
      <div class="departments-modal">
        <button class="close-btn" onclick="closeDepartmentsModal()">
          &times;
        </button>
        <h2>ุฅุฏุงุฑุฉ ุงูุฃูุณุงู</h2>

        <form id="departmentForm">
          <div class="form-group">
            <label for="departmentName">ุงุณู ุงููุณู</label>
            <input
              type="text"
              id="departmentName"
              name="departmentName"
              placeholder="ุฃุฏุฎู ุงุณู ุงููุณู"
              required
            />
          </div>

          <div class="login-buttons">
            <button type="submit" class="btn btn-save">ุฅุถุงูุฉ ูุณู</button>
            <button
              type="button"
              class="btn btn-cancel"
              onclick="closeDepartmentsModal()"
            >
              ุฅูุบุงุก
            </button>
          </div>
        </form>

        <table class="modal-table">
          <thead>
            <tr>
              <th>ุงุณู ุงููุณู</th>
              <th>ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody id="departmentsList">
            <% departments.forEach(function(dept) { %>
            <tr>
              <td><%= dept %></td>
              <td class="action-buttons">
                <button
                  class="action-btn delete-btn"
                  onclick="deleteDepartment('<%= dept %>')"
                >
                  ุญุฐู
                </button>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Users Management Modal -->
    <div class="modal-overlay" id="usersModal">
      <div class="users-modal">
        <button class="close-btn" onclick="closeUsersModal()">&times;</button>
        <h2>ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู</h2>

        <form id="userForm">
          <div class="form-group">
            <label for="userName">ุงุณู ุงููุณุชุฎุฏู</label>
            <input
              type="text"
              id="userName"
              name="userName"
              placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู"
              required
            />
          </div>

          <div class="form-group">
            <label for="userRole">ุงูุฏูุฑ</label>
            <select
              id="userRole"
              name="userRole"
              style="background-color: #1e3c72"
              required
            >
              <option value="">ุงุฎุชุฑ ุงูุฏูุฑ</option>
              <option value="admin">ูุฏูุฑ</option>
              <option value="staff">ููุธู</option>
            </select>
          </div>

          <div class="form-group">
            <label for="userPassword">ูููุฉ ุงููุฑูุฑ</label>
            <input
              type="password"
              id="userPassword"
              name="userPassword"
              placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ"
              required
            />
          </div>

          <div class="login-buttons">
            <button type="submit" class="btn btn-save">ุฅุถุงูุฉ ูุณุชุฎุฏู</button>
            <button
              type="button"
              class="btn btn-cancel"
              onclick="closeUsersModal()"
            >
              ุฅูุบุงุก
            </button>
          </div>
        </form>

        <table class="modal-table">
          <thead>
            <tr>
              <th>ุงุณู ุงููุณุชุฎุฏู</th>
              <th>ุงูุฏูุฑ</th>
              <th>ุงูุฅุฌุฑุงุกุงุช</th>
            </tr>
          </thead>
          <tbody>
            <% users.forEach(function(user) { %>
            <tr>
              <td><%= user.username %></td>
              <td><%= user.role %></td>
              <td class="action-buttons">
                <button
                  class="action-btn edit-btn"
                  onclick="editUser('<%=user.username%>', '<%=user.role%>')"
                >
                  ุชุนุฏูู
                </button>
                <button
                  class="action-btn delete-btn"
                  onclick="deleteUser('<%=user.username%>')"
                >
                  ุญุฐู
                </button>
              </td>
            </tr>
            <% }); %>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Reports Modal -->
<div class="modal-overlay" id="reportsModal">
  <div class="reports-modal">
    <button class="close-btn" onclick="closeReportsModal()">&times;</button>
    <h2>ุงูุชูุงุฑูุฑ</h2>
    
    <div class="report-tabs">
      <div class="report-tab active" onclick="showReportSection('dailyReportSection')">ุชูุฑูุฑ ุงูููู</div>
      <div class="report-tab" onclick="showReportSection('comprehensiveReportSection')">ุชูุฑูุฑ ุดุงูู</div>
      <div class="report-tab" onclick="showReportSection('backupSection')">ูุณุฎุฉ ุงุญุชูุงุทูุฉ</div>
    </div>
    
    <!-- ุชูุฑูุฑ ุงูููู -->
    <div class="report-section active" id="dailyReportSection">
      <div class="form-group">
        <label for="dailyReportDate">ุชุงุฑูุฎ ุงูุชูุฑูุฑ</label>
        <input type="date" id="dailyReportDate" required>
      </div>
      <button class="btn btn-generate" onclick="generateDailyReport()">ุนุฑุถ ุงูุชูุฑูุฑ</button>
      <div id="dailyReportOutput" class="report-output"></div>
    </div>
    
    <!-- ุงูุชูุฑูุฑ ุงูุดุงูู -->
    <div class="report-section" id="comprehensiveReportSection">
      <div class="form-row">
        <div class="form-group">
          <label for="reportStartDate">ูู ุชุงุฑูุฎ</label>
          <input type="date" id="reportStartDate" required>
        </div>
        <div class="form-group">
          <label for="reportEndDate">ุฅูู ุชุงุฑูุฎ</label>
          <input type="date" id="reportEndDate" required>
        </div>
      </div>
      <div class="form-group">
        <label for="reportDepartment">ุงููุณู</label>
        <select id="reportDepartment">
          <option value="ุฌููุน ุงูุฃูุณุงู">ุฌููุน ุงูุฃูุณุงู</option>
          <% departments.forEach(function(dept) { %>
              <option value="<%= dept %>"><%= dept %></option>
              <% }); %>
        </select>
      </div>
      <button class="btn btn-generate" onclick="generateComprehensiveReport()">ุนุฑุถ ุงูุชูุฑูุฑ</button>
      <div id="comprehensiveReportOutput" class="report-output"></div>
    </div>
    
    <!-- ุชูุฑูุฑ ุงูุชูุงุนู -->
    <div class="report-section" id="interactionReportSection">
      <div class="form-row">
        <div class="form-group">
          <label for="interactionStartDate">ูู ุชุงุฑูุฎ</label>
          <input type="date" id="interactionStartDate" required>
        </div>
        <div class="form-group">
          <label for="interactionEndDate">ุฅูู ุชุงุฑูุฎ</label>
          <input type="date" id="interactionEndDate" required>
        </div>
      </div>
      <div class="form-group">
        <label for="interactionDepartment">ุงููุณู</label>
        <select id="interactionDepartment">
          <option value="ุฌููุน ุงูุฃูุณุงู">ุฌููุน ุงูุฃูุณุงู</option>
          <% departments.forEach(function(dept) { %>
              <option value="<%= dept %>"><%= dept %></option>
              <% }); %>
        </select>
      </div>
      <button class="btn btn-generate" onclick="generateInteractionReport()">ุนุฑุถ ุงูุชูุฑูุฑ</button>
      <div id="interactionReportOutput" class="report-output"></div>
    </div>
    
    <!-- ุงููุณุฎ ุงูุงุญุชูุงุทู -->
    <div class="report-section" id="backupSection">
      <div class="backup-options">
        <button class="btn btn-backup" onclick="downloadBackup()">ูุณุฎุฉ ุงุญุชูุงุทูุฉ (ZIP)</button>
        <p class="backup-note">ุณูุชู ุชูุฒูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุฌููุน ุงูุจูุงูุงุช ูู formato JSON</p>
      </div>
    </div>
  </div>
</div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
      <!-- Navigation Bar -->
      <nav class="navbar">
        <button class="mobile-menu-btn" onclick="toggleMobileMenu()">โฐ</button>

        <div class="logo-section">
          <img
            src="/images/logo.png"
            alt="ุดุนุงุฑ ูุฒุงุฑุฉ ุงูุตุญุฉ"
          />
        </div>

<div class="nav-right" id="navRight">
  <div class="dropdown">
    <a href="#appointments">ุงูููุงุนูุฏ</a>
    <div class="dropdown-content">
      <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
      <a href="#" onclick="openAppointmentModal()">ุฅุถุงูุฉ ููุนุฏ</a>
      <% } %>
      <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
      <a href="#" onclick="openSearchModal()">ุจุญุซ ุนู ููุนุฏ</a>
      <% } %>
      <% if (currentUser && currentUser.role === 'admin') { %>
      <a href="#" onclick="deleteAllA()">ุญุฐู ุฌููุน ุงูููุงุนูุฏ</a>
      <% } %>
    </div>
  </div>
  
  <!-- ุฅุถุงูุฉ ุฑุงุจุท ุงูุชูุงุฑูุฑ -->
  <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
  <a href="#" onclick="openReportsModal()">ุงูุชูุงุฑูุฑ</a>
  <% } %>

  <!-- ูุงุฆูุฉ ุงูุฅุฏุงุฑุฉ -->
  <% if (currentUser && currentUser.role === 'admin') { %>
  <div class="dropdown">
    <a href="#management">ุงูุฅุฏุงุฑุฉ</a>
    <div class="dropdown-content">
      <a href="#" onclick="openDepartmentsManagement()">ุงูุฃูุณุงู</a>
      <a href="#" onclick="openUsersManagement()">ุงููุณุชุฎุฏููู</a>
      <a href="/settings">ุตูุญุฉ ุงูุฅุนุฏุงุฏุงุช</a>
    </div>
  </div>
  <% } %>

  <!-- ูุนูููุงุช ุงููุณุชุฎุฏู ุงูุญุงูู -->
  <% if (currentUser) { %>
  <div class="user-info">
    <span class="user-name"><%= currentUser.username %></span>
    <span class="user-role">(<%= currentUser.role === 'admin' ? 'ูุฏูุฑ' : 'ููุธู' %>)</span>
    <button class="logout-btn" onclick="logout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
  </div>
  <% } %>

  <!-- ุฒุฑ ุชุจุฏูู ุงููุธูุฑ -->
  <button class="theme-toggle" id="themeToggle" title="ุชุจุฏูู ุงููุธูุฑ">
    ๐
  </button>
</div>

        <div class="window-controls">
          <button class="window-btn minimize"></button>
          <button class="window-btn maximize"></button>
          <button class="window-btn close"></button>
        </div>
      </nav>
      

      <!-- Main Container -->
      <div class="container">
        <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:15px;flex-wrap:wrap;">
          <span>ุทุฑููุฉ ุงูุนุฑุถ:</span>
          <button class="btn btn-cancel" type="button" onclick="setViewMode('card')">ุจุทุงูุงุช</button>
          <button class="btn btn-cancel" type="button" onclick="setViewMode('simple')">ูุงุฆูุฉ ูุจุณุทุฉ</button>
        </div>
        <% } %>
        <!-- Appointments Table -->
        <div class="appointments-table">
          <div class="table-body" id="appointmentsTableBody">
            <% if (appointments.length===0) { %> ูุง ุชูุฌุฏ ููุงุนูุฏ ูุณุฌูุฉ ุญุงููุงู <%
            } else { %> <% appointments.forEach(function(appointment, index) {
            %>
            <div class="appointment-card">
              <div class="appointment-card-header">
                <div class="appointment-number">#<%= index + 1 %></div>
                <div class="appointment-status"><%= appointment.status %></div>
              </div>
              <div class="appointment-card-body">
                <div class="appointment-info">
                  <span class="appointment-label">ุงุณู ุงููุฑูุถ</span>
                  <span class="appointment-value"
                    ><%= appointment.patientName %></span
                  >
                </div>
                <div class="appointment-info">
                  <span class="appointment-label">ุฑูู ุงููููุฉ</span>
                  <span class="appointment-value"
                    ><%= appointment.patientId %></span
                  >
                </div>
                <div class="appointment-info">
                  <span class="appointment-label">ุฑูู ุงูุฌูุงู</span>
                  <span class="appointment-value"
                    ><%= appointment.patientPhone %></span
                  >
                </div>
                <% if (appointment.patientBirthDate) { %>
                <div class="appointment-info">
                  <span class="appointment-label">ุชุงุฑูุฎ ุงููููุงุฏ</span>
                  <span class="appointment-value"
                    ><%= appointment.patientBirthDate %></span
                  >
                </div>
                <% } %>
                <div class="appointment-info">
                  <span class="appointment-label">ุงููุณู</span>
                  <span class="appointment-value"
                    ><%= appointment.department %></span
                  >
                </div>
                <div class="appointment-info">
                  <span class="appointment-label">ุงูุชุงุฑูุฎ</span>
                  <span class="appointment-value"
                    ><%= appointment.appointmentDate %></span
                  >
                </div>
                <div class="appointment-info">
                  <span class="appointment-label">ุงูููุช</span>
                  <span class="appointment-value"
                    ><%= appointment.appointmentTime %></span
                  >
                </div>
              </div>
              <div class="appointment-actions">
                <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
                <button
                  class="action-btn delete-btn"
                  onclick="deleteAppointment('<%= appointment.id %>')"
                >
                  ุญุฐู
                </button>
                <button
                  class="action-btn edit-btn"
                  onclick="openEditAppointmentModal(<%= JSON.stringify(appointment).replace(/"/g, '&quot;') %>)"
                >
                  ุชุนุฏูู
                </button>
                <% } %>
                <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
                <button
                  class="action-btn done-btn"
                  onclick="toggleAppointmentStatus('<%= appointment.id %>')"
                >
                  <%= appointment.status === "ุงูุชุธุงุฑ" ? "ููุฌุฒ" : "ุงูุชุธุงุฑ" %>
                </button>
                <% } %>
              </div>
            </div>
            <% }); %> <% } %>
          </div>
        </div>

        <!-- Simple List (Excel-like) -->
        <div id="appointmentsTableSimple" style="display:none; max-height: 420px; overflow-y: auto; border: 1px solid rgba(0,0,0,0.1); border-radius: 10px;">
          <table class="modal-table" style="width:100%;">
            <thead>
              <tr>
                <th>#</th>
                <th>ุงูุงุณู</th>
                <th>ุงููููุฉ</th>
                <th>ุงูุฌูุงู</th>
                <th>ุงููุณู</th>
                <th>ุงูุชุงุฑูุฎ</th>
                <th>ุงูููุช</th>
                <th>ุงูุญุงูุฉ</th>
                <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
                <th>ุฅุฌุฑุงุกุงุช</th>
                <% } %>
              </tr>
            </thead>
            <tbody id="appointmentsSimpleBody">
              <tr><td colspan="9">ูุง ุชูุฌุฏ ููุงุนูุฏ ูุนุฑุถูุง.</td></tr>
            </tbody>
          </table>
        </div>

        <div class="summary-section">
          <div class="summary-header">ููุฎุต ุงูููู ุญุณุจ ุงููุณู</div>
          <table class="summary-table">
            <thead>
              <tr>
                <th>ุงููุณู</th>
                <th>ุนุฏุฏ ุงูููุงุนูุฏ ุงูููุฌุฒุฉ</th>
              </tr>
            </thead>
            <tbody id="todaySummaryBody">
              <tr>
                <td colspan="2">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="summary-section">
          <div class="summary-header">ููุฎุต ุงูุงูุชุธุงุฑ ุญุณุจ ุงููุณู</div>
          <table class="summary-table">
            <thead>
              <tr>
                <th>ุงููุณู</th>
                <th>ุนุฏุฏ ุงูููุงุนูุฏ ุงูููุชุธุฑุฉ</th>
              </tr>
            </thead>
            <tbody id="waitingSummaryBody">
              <tr>
                <td colspan="2">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Page Controls -->
        <div class="page-controls">
          <div class="page-info">ุงูุตูุญุฉ 1 ูู 1</div>
          <div class="page-nav">
            <button disabled>ุงูุณุงุจู</button>
            <button disabled>ุงูุชุงูู</button>
          </div>
        </div>
      </div>

      <!-- Floating Action Button -->
      <% if (currentUser && (currentUser.role === 'admin' || currentUser.role === 'staff')) { %>
      <button
        class="fab"
        title="ุฅุถุงูุฉ ููุนุฏ ุฌุฏูุฏ"
        onclick="openAppointmentModal()"
      >
        +
      </button>
      <% } %>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </body>
</html>